# üîß SOC-CERT n8n Workflows

## üìã Complete Workflow

### Single All-in-One File: `soc-cert.json`

The complete SOC-CERT workflow contains **all nodes in a single JSON file** for easy import and deployment.

**What's Inside:**

1. **Main Flow**

   - Receives extension alerts via webhook
   - Real-time Gemini AI analysis
   - Virtual CVE generation
   - Redis storage for persistence

2. **CVE Correlation**

   - Threat enrichment with CISA KEV Catalog (1400+ CVEs)
   - Intelligence threat mapping
   - Automatic CVE matching

3. **Statistics Processing**
   - Metrics aggregation
   - Virtual CVE dashboard data
   - Real-time analytics

**Important Note:**

Only the **essential nodes** required for core extension functionality are activated. Communication nodes (Gmail, Slack, Google services) are **disabled by default** as they're not necessary for the extension to work. You can enable them later if needed.

## üöÄ Quick Installation

### Prerequisites

- **n8n instance** (local or cloud)
- **Redis database** (for data persistence)
- **Vercel deployment** (optional - for production API endpoints)

### Installation Steps

#### 1. Import the Workflow

1. Open your n8n interface
2. Go to **Workflows** ‚Üí **Import from File**
3. Select `soc-cert.json` from the `n8n-workflows/` folder
4. Click **Import**

#### 2. Configure Environment Variables

Edit the workflow settings and add the following credentials:

REDIS_URL=your_redis_connection_string
VERCEL_URL=your_vercel_app_url (optional)
API_SECRET=your_optional_api_secret

text

**Where to add them:**

- Click on each node that requires credentials
- Add Redis connection details
- Add API keys if using external services

#### 3. Activate Webhooks

1. Click on each **Webhook node** in the workflow
2. Copy the webhook URLs generated by n8n
3. Update your Chrome extension configuration with these URLs
4. Click **Activate** on the workflow (toggle in top-right)

#### 4. Test the Setup

Use the provided test examples (see Testing section below).

## ‚öôÔ∏è Configuration

### Environment Variables

Required
REDIS_URL=redis://localhost:6379

or for cloud Redis
REDIS_URL=redis://:password@your-redis-host:6379

Optional (if using Vercel)
VERCEL_URL=https://your-app.vercel.app
API_SECRET=your_secret_key_here

text

### Main Webhooks

Once activated, your workflow will expose these endpoints:

- **POST** `/api/extension-webhook` - Receives threat alerts from extension
- **GET** `/api/extension-result` - Returns analysis results
- **POST** `/api/update-stats` - Updates statistics dashboard

**Note:** The exact URLs will depend on your n8n deployment (local or cloud).

## üß™ Testing

### Prerequisites

- n8n workflow is **active** (green indicator)
- Redis connection is working
- Webhooks are accessible

### Test with Sample Request

Set your webhook URL (from n8n)
export WEBHOOK_URL="https://your-n8n-instance.com/webhook/extension-webhook"

Test the main workflow
curl -X POST $WEBHOOK_URL
-H "Content-Type: application/json"
-d '{
"url": "http://testphp.vulnweb.com/test",
"threatLevel": "high",
"timestamp": "2025-10-22T18:00:00Z"
}'

text

### Expected Response

{
"status": "success",
"threatLevel": "high",
"virtualCVE": "CVE-2025-1729123456-ABCD",
"cveMatches": [
{
"id": "CVE-2020-0618",
"severity": "HIGH"
}
],
"recommendations": [
"Block access to vulnerable endpoint",
"Update security patches"
]
}

text

### Verification Checklist

After testing, verify:

- ‚úÖ n8n execution logs show successful run (green checkmark)
- ‚úÖ Redis database contains the stored threat data
- ‚úÖ Response includes CVE correlation results
- ‚úÖ Virtual CVE was generated (if no match found)

## üìä Architecture

Chrome Extension
‚Üì
Webhook (n8n)
‚Üì
Gemini AI Analysis
‚Üì
CVE Correlation (CISA KEV)
‚Üì
Redis Storage
‚Üì
API Response ‚Üí Extension

text

**Detailed Flow:**

1. **Extension Detection:** Chrome extension detects a threat
2. **Webhook Trigger:** Sends data to n8n webhook
3. **AI Analysis:** Gemini processes threat intelligence
4. **CVE Matching:** Correlates with CISA KEV Catalog (1400+ CVEs)
5. **Virtual CVE:** Generates virtual CVE if no match found
6. **Storage:** Saves to Redis for persistence
7. **Response:** Returns enriched data to extension

## üÜò Troubleshooting

### ‚ùå Webhook Not Received

**Symptoms:** Extension sends request but n8n doesn't execute

**Solutions:**

- **Check:** Webhook URL is correct in extension config
- **Verify:** Workflow is **activated** (green toggle in n8n)
- **Test:** Try accessing webhook URL in browser (should return method info)
- **Firewall:** Ensure n8n port is accessible (default: 5678)

### ‚ùå Redis Connection Errors

**Symptoms:** Workflow fails at Redis node

**Solutions:**

- **Verify:** Redis is running: `redis-cli ping` (should return `PONG`)
- **Check:** Connection string format: `redis://[password@]host:port`
- **Test:** Try connecting manually: `redis-cli -h host -p port`
- **Permissions:** Ensure Redis user has write permissions

### ‚ùå Gemini AI Timeout

**Symptoms:** Workflow hangs or times out at AI analysis

**Solutions:**

- **Increase timeout:** Edit node settings ‚Üí Set timeout to 90-120 seconds
- **Check network:** Ensure n8n can reach external APIs
- **API limits:** Verify Gemini API quota is not exceeded
- **Fallback:** Enable mock data for testing without API

### ‚ùå No CVE Correlation Data

**Symptoms:** Response doesn't include CVE matches

**Solutions:**

- **Check:** CISA KEV Catalog node is enabled in workflow
- **Verify:** External API access is allowed (firewall/proxy)
- **Update:** Refresh CVE database if using cached data
- **Logs:** Check n8n execution logs for specific errors

### ‚ùå Extension Not Receiving Response

**Symptoms:** Extension shows "Loading..." but no results

**Solutions:**

- **CORS:** Ensure n8n allows extension origin
- **Polling:** Check extension polling interval (default: 5s)
- **Redis:** Verify data is stored with correct key
- **Logs:** Check both n8n and browser console for errors

## üìù Workflow Customization

### Enable Communication Nodes

To enable email/Slack notifications:

1. Open `soc-cert.json` in n8n
2. Find disabled nodes (grayed out)
3. Right-click ‚Üí **Enable**
4. Add credentials (Gmail, Slack, etc.)
5. Configure trigger conditions
6. Save and activate workflow

### Add Custom Nodes

The workflow is modular - you can add:

- **Custom threat sources** (APIs, databases)
- **Additional AI models** (OpenAI, Claude)
- **Alert channels** (Discord, Teams, PagerDuty)
- **Data exports** (CSV, PDF reports)

---

**Need Help?**

- Check main project documentation: [README.md](../README.md)
- Review extension installation: [INSTALL.md](../INSTALL.md)
- Open issue on GitHub: https://github.com/joupify/soc-cert-guardian-extension/issues

**Built by:** Joupify  
**License:** MIT
